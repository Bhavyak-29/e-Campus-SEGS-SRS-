<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DA-IICT - Term Course List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/ecampus.css}" />

    <style>
        body {
            background-color: #f9fafb;
        }

        h2 {
            font-weight: 600;
        }

        .table {
            border-radius: 12px;
            overflow: hidden;
        }

        select.form-select {
            display: inline-block;
            width: auto;
            padding: 4px 10px;
            font-size: 0.95rem;
        }

        .btn-primary {
            border-radius: 6px;
        }

        .alert {
            max-width: 800px;
            margin: auto;
        }
    </style>

    <script>
        function assignFaculty(tcrid) {
            const slot = document.getElementById('slot-' + tcrid).value;
            if (!slot) {
                alert('⚠️ Please select a slot before assigning a faculty.');
                return false;
            }
            // Redirect to controller endpoint with tcrid and slot
            window.location.href = `/courses/assign-faculty?tcrid=${tcrid}&slot=${slot}`;
        }
    </script>
</head>

<body>
<!-- Common Header -->
<div th:insert="~{fragments/commonHeader :: mainHeader}"></div>

<div class="container mt-4">
    <h2 class="text-center mb-4">Courses for Selected Term</h2>

    <div th:if="${success}" class="alert alert-success text-center" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>

    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle text-center">
            <thead class="table-dark">
                <tr>
                    <th>Course ID</th>
                    <th>Course Name</th>
                    <th>Slot</th>
                    <th>Assigned Faculty</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="course : ${termCourses}">
                    <td th:text="${course.course.crsid}"></td>
                    <td th:text="${course.course.crsname}"></td>

                    <!-- Slot Dropdown -->
                    <td>
                        <select class="form-select" th:id="'slot-' + ${course.tcrid}">
                            <option value="">Select Slot</option>
                            <option th:each="i : ${#numbers.sequence(1,8)}"
                                    th:value="${i}" th:text="${i}"
                                    th:selected="${course.slot == i}">
                            </option>
                        </select>
                    </td>

                    <!-- Assigned Faculty Display -->
                    <td th:text="${course.user != null ? course.user.uemail : 'Not Assigned'}"
                        th:style="${course.user != null} ? 'color: green;' : 'color: gray;'">
                    </td>

                    <!-- Assign Faculty Button -->
                    <td>
                        <button type="button" class="btn btn-primary"
                                th:onclick="'assignFaculty(' + ${course.tcrid} + ')'">
                            Assign Faculty
                        </button>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(termCourses)}">
                    <td colspan="5" class="text-muted">No courses found for the selected term.</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Footer -->
<div class="text-center mt-5 mb-3">
    <p>&copy; 2025 DA-IICT</p>
</div>

</body>
</html>

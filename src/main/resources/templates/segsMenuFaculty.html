<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Faculty Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/ecampus.css}" />
</head>
<body>

<!-- Common Header -->
<div th:insert="~{fragments/commonHeader :: mainHeader}"></div>

<div class="container mt-4">

    <!-- Welcome Section -->
    <div class="mb-4 text-center">
        <h2>Welcome to Faculty Dashboard</h2>
        <hr style="width:70%;margin:auto"/>

        <p class="mt-2" style="font-size: 16px">
            <strong>
                <!-- SAFE ACCESS -->
                <span th:text="${faculty != null ? faculty.ufullname : session.username}">
                    Faculty Name
                </span>
            </strong>
        </p>

        <p class="mt-1" style="font-size: 14px">
            <h3>Faculty User ID:</h3>
            <h3 th:text="${faculty != null ? faculty.uid : '200491003'}">EMP001</h3>
        </p>
        <p class="mt-1" style="font-size: 14px">
            <h3>Designation:</h3>
            <h3>FACULTY</h3>
        </p>
        
    </div>

    <!-- Current Semester Header -->
    <div class="mb-3">
        <h4>
            Current Semester Courses:
            <span class="text-primary fw-bold"
                  th:text="${latestTerm != null ? latestTerm.trmname : 'Not Assigned'}">
                Autumn 2025
            </span>
        </h4>
    </div>

    <!-- Error Message -->
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Courses Table -->
    <table class="table table-bordered align-middle">
        <thead class="table-light">
        <tr>
            <th>Course</th>
            <th style="width:12%">Students</th>
            <th style="width:40%">Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="tc : ${termCourses}">
            <td>
                <strong th:text="${tc.course != null ? tc.course.crscode : ''}">IE494</strong> -
                <span th:text="${tc.course != null ? tc.course.crsname : 'Unknown Course'}"></span>
            </td>

            <td class="text-center fw-semibold">
                <span th:text="${studentCounts != null && studentCounts[tc.tcrid] != null 
                                ? studentCounts[tc.tcrid] : 0}">
                    0
                </span>
            </td>

            <td>
                <div class="d-flex flex-wrap gap-2">
                   <a class="btn btn-sm btn-outline-primary"
   th:href="@{/registrations/courses(tcrid=${tc.tcrid})}">
    View Registrations
</a>

                    <a class="btn btn-sm btn-success"
                       th:href="@{/directGradeEntry/gradeOptions(CRSID=${tc.tcrcrsid})}">
                        Upload Grades
                    </a>

                    <a class="btn btn-sm btn-warning"
                       th:href="@{/directGradeEntry}">
                        Modify Grade
                    </a>

                    <a class="btn btn-sm btn-outline-danger"
                       th:href="@{/directGradeEntry}">
                        Revise I-Grade
                    </a>

                    <a class="btn btn-sm btn-outline-info"
                       th:href="@{/faculty/course/feedback(tcrid=${tc.tcrid})}">
                        View Feedback
                    </a>
                </div>
            </td>
        </tr>

        <!-- No Courses -->
        <tr th:if="${#lists.isEmpty(termCourses)}">
            <td colspan="3" class="text-center text-muted py-4">
                No courses assigned for this semester.
            </td>
        </tr>

        </tbody>
    </table>

    <p class="text-muted mt-2" style="font-size:13px;">
        * Modify & Revise Grade buttons activate only after grade upload.
    </p>

    <!-- Footer -->
    <div class="row justify-content-center mt-4">
        <div class="col-md-10 footer" style="font-size: 14px">
            &copy; 2002 DA-IICT, Near Indroda Circle, Ahmedabad-Gandhinagar Highway,
            Gandhinagar - 382 009, Gujarat, India.<br>
            Designed & Built by <strong>Bhavya, Sumit & Harsh</strong>
        </div>
    </div>
</div>

</body>
</html>

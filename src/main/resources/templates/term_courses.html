<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Term Courses</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/ecampus.css}" />
  </head>
  <body>
    <table>
      <div th:insert="fragments/commonHeader :: mainHeader"></div>
      <div class="container mt-5 text-center">
        <tr>
          <td class="sidemenu"></td>
          <td class="content">
            <!-- Start of injected course-term form -->
            <div class="container mt-4">
              <h3
                th:if="${selectedAcademicYearId != null and termId != null}"
                th:text="'Academic Year: ' + ${ayrname} + ', Term: ' + ${trmname}"
              ></h3>
              <!-- Show form only if no termCourses loaded -->
              <div class="container mt-4" th:if="${termCourses == null}">
                <div class="card p-4 shadow-sm border-0 rounded-4">
                  <h5 class="text-center fw-bold mb-3">
                    Select Academic Year and Term
                  </h5>

                  <form
                    method="get"
                    th:action="@{/courses/term}"
                    class="row gy-3 gx-4 justify-content-center align-items-end"
                  >
                    <div class="col-md-4">
                      <label for="academicYear" class="form-label fw-semibold"
                        >Academic Year</label
                      >
                      <select
                        class="form-select"
                        id="academicYear"
                        name="academicYearId"
                        onchange="this.form.submit()"
                      >
                        <option value="">Select</option>
                        <option
                          th:each="ay : ${academicYears}"
                          th:value="${ay.ayrid}"
                          th:text="${ay.ayrname}"
                          th:selected="${ay.ayrid == selectedAcademicYearId}"
                        ></option>
                      </select>
                    </div>

                    <div class="col-md-4">
                      <label for="term" class="form-label fw-semibold"
                        >Term</label
                      >
                      <select class="form-select" id="term" name="termId">
                        <option value="">Select</option>
                        <option
                          th:each="term : ${terms}"
                          th:value="${term.trmid}"
                          th:text="${term.trmname}"
                          th:selected="${term.trmid == termId}"
                        ></option>
                      </select>
                    </div>

                    <div class="col-md-2 d-grid">
                      <button type="submit" class="btn btn-primary">
                        View Courses
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <div class="my-4"></div>

              <table
                th:if="${termCourses != null}"
                class="table table-bordered table-striped"
              >
                <thead>
                  <tr>
                    <th>Sr No</th>
                    <th>Course Name</th>
                    <th>Course Credit</th>
                    <th>Course Code</th>
                    <th>Faculty id</th>
                    <th>Assigned Faculty</th>
                    <th th:if="${showOverlap}">Check</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="course, iterStat : ${termCourses}">
                    <td th:text="${iterStat.index + 1}"></td>
                    <td th:text="${course.course.crsname}"></td>
                    <td th:text="${course.course.crscreditpoints}"></td>
                    <td th:text="${course.course.crscode}"></td>
                    <td
                      th:text="${course.user != null ? course.user.uname : 'N/A'}"
                    ></td>
                    <td
                      th:text="${course.user != null ? course.user.uemail : 'N/A'}"
                    ></td>
                    <td th:if="${showOverlap}">
                      <input
                        type="checkbox"
                        th:value="${course.crsid}"
                        name="SelectedTcrId"
                      />
                    </td>
                  </tr>
                </tbody>
              </table>

              <div class="mt-3" th:if="${termCourses != null}">
                <a
                  th:href="@{/courses/term/excel(academicYearId=${selectedAcademicYearId}, termId=${termId})}"
                  class="btn btn-success"
                  >Download Excel</a
                >
                <a th:href="@{/courses/term}" class="btn btn-secondary"
                  >&laquo; Back</a
                >
              </div>
            </div>
            <!-- End of injected content -->
          </td>
          <td class="sidemenu"></td>
        </tr>

        <tr>
          <td class="sidemenu"></td>
          <td class="footer" colspan="1">
            &copy; 2002 DA-IICT, Near Indroda Circle, Ahmedabad-Gandhinagar
            Highway, Gandhinagar - 382 009, Gujarat, India.<br />
            Designed, developed and maintained by Bhavya, Sumit & Harsh
          </td>
          <td class="sidemenu"></td>
        </tr>
      </div>
    </table>
  </body>
</html>
